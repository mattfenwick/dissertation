\chapter{Results}

This chapter describes an approach which renders NMR analysis reproducible,
as well as an application and an implementation of the approach.



\section{Strategy for reproducible NMR analysis}

\subsection{Intermediate results}
sequence of snapshots

\subsection{Deductive reasoning}
rule based system
library of rules
apply rule to each snapshot

\subsection{Extraneous results}
allow extra peaks and GSSs, augment them with additional data fields which distinguish between signal, 
noise, contaminants, etc.  A distinction is made 
between: 1) finding/recording a peak based purely on characteristics of 
the spectrum such as volume, height, relative height compared to noise, 
lineshape, and linewidth, and 2) interpreting a peak as signal, noise, 
etc. (and the same for GSSs).  Even peaks and GSSs for 
which no analysis is made can be kept in the data set without encumbering 
assignment of true peaks and GSSs.



\section{Sparky Extension for Reproducible Spectral Analysis}

Sparky \cite{sparky} is a popular program for interactive peak picking,
GSS construction, and chemical shift assignment.  Sparky is implemented 
with a C++ core, and Python extensions.
A Sparky extension was implemented to assist with reproducible analysis.

A Sparky distribution with the reproducibility extension can be found at
\url{https://github.com/mattfenwick/SparkyExtensions/releases}.  Simply 
choose the latest version of the correct platform, download it, untar and 
unzip it, and run the sparky executable (in Contents/Resources/bin in the
Mac version, and bin/ in the Linux version).
The reproducibility extension requires a working git installation.
Sparky manuals may be found at \url{http://www.cgl.ucsf.edu/home/sparky/manual/} 
and \url{http://pine.nmrfam.wisc.edu/PINE-SPARKY/}.
Sparky's data model was extended with GSSs and resonances as in the CCPN model \cite{ccpn}.



\section{Application of approach: reproducible data set}
In order to prove the validity of the approach described in the previous chapter, 
it was applied to typical NMR data in order to solve a protein structure.
Time-domain data of Samp3, a Ubiquitin-like protein, were kindly provided by 
Dr. Mark Maciejewski.  The analysis was performed using the Sparky reproducibility
extension.  The final result was a git repository containing a Sparky project
and additional data.

Starting from time-domain data sets, I carried out the 
standard data analysis process using a subset of the CCPN data model \cite{ccpn}, 
with the additional property that the process itself was captured as
a series of annotated snapshots, and extraneous results were recorded as well.
The full data set including complete annotated snapshot history may be found at 
\url{https://github.com/mattfenwick/samp3}
(a previous version using the CCPN Analysis program may additionally be found
at \url{https://github.com/mattfenwick/PeakPicker}).



\section{Archiving reproducible data sets}
The NMR-STAR format is used by the BioMagResBank (BMRB) to archive and
disseminate NMR data.  NMR-STAR is a textual data format, and there is also
an NMR-STAR data dictionary which lists the allowed data types and their
semantics.  To allow the archival of reproducible data sets in NMR-STAR format,
the NMR-STAR data dictionary was extended with several additional data types.
The Samp3 analysis was then extracted from the git repository and an NMR-STAR
file generated according to the newly extended data dictionary.
% link to the data set or something



% \section{Summary}

